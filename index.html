<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WeatherApp</title>
  </head>
  <body>
    <form id="weather-search">
      <input type="search" placeholder="Search for a location ..." autofocus />
      <input type="submit" value="Get the weather!" />
    </form>
    <div class="weather-display"></div>

    <script>
      async function getWeather(location) {
        // TODO: add error-catching!
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${location}&appid=04677966a703b0124f576651b3349deb&units=metric`
        );

        const weather = await response.json();
        return weather;
      }

      async function createWeatherObject(location) {
        const data = await getWeather(location);
        // log data for reference for now
        console.log(data);
        return {
          location: data.name,
          country: data.sys.country,
          temperature: data.main.temp,
          weather: data.weather[0].description,
          icon: data.weather[0].icon,
          wind: data.wind.speed,
          cloudiness: data.clouds.all,
        };
      }

      async function displayWeather(e) {
        e.preventDefault(); // prevent form from reloading the page
        const location = e.target.querySelector("input[type='search']").value;

        const weatherObject = await createWeatherObject(location);
        console.log(weatherObject);
        // populate the DOM! (grab some div or so, delete what was there if anything, create new stuff and put it in. Separate functions for this stuff).
        deleteDOM();
        populateDOM(weatherObject);
      }

      function deleteDOM() {
        while (weatherDisplay.childNodes.length > 0) {
          weatherDisplay.lastChild.remove();
        }
      }

      function populateDOM(weatherData) {
        const weatherDescr = document.createElement("p");
        weatherDescr.textContent = weatherData.weather;

        const location = document.createElement("p");
        location.textContent = `${weatherData.location}, ${weatherData.country}`;

        const temperature = document.createElement("p");
        temperature.textContent = `${weatherData.temperature}Â° C`;

        // icons see: https://openweathermap.org/weather-conditions#How-to-get-icon-URL
        const icon = document.createElement("img");
        icon.src = `http://openweathermap.org/img/wn/${weatherData.icon}@2x.png`;
        icon.setAttribute("alt", `${weatherData.weather}`);

        weatherDisplay.appendChild(weatherDescr);
        weatherDisplay.appendChild(location);
        weatherDisplay.appendChild(temperature);
        weatherDisplay.appendChild(icon);

        //wind /+wind direction?
        //humidity
        //cloudiness
        //feels like
        //min/max-temp?
        //sunrise/sunset
        //local time?

        //geolocation

        //flag of the country??
      }

      const search = document.querySelector("#weather-search");
      const weatherDisplay = document.querySelector(".weather-display");

      search.addEventListener("submit", displayWeather);
    </script>
  </body>
</html>
